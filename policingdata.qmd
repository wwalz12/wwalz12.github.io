---
title: "Project 5: Analzying US Traffic Stops"
description: "SQL-based Analysis of Traffic Stop Patterns Across U.S. Agencies"
author: William Walz
date: December 6, 2025
format: 
  html:
    code-fold: true
    code-summary: "Show code"
execute: 
  warning: false
  message: false
---

Using SQL and R, this project explores how traffic-stop data is structured across three jurisdictions in the Stanford Open Policing Project (SOPP). The objective is purely descriptive: to summarize what the dataset records rather than inferring motivations or causal mechanisms behind policing practices. Each section focuses on a specific layer of the data.

I begin by examining how the racial composition of recorded stops in New York State changes over time, normalizing the data as percentages to allow for consistent comparison across years. Next, I compare Long Beach and San Bernardino to demonstrate how different agencies categorize stop types and how those reporting conventions shape the dataset's structure. Finally, I analyze search and frisk rates in Florida, looking at how they differ across racial categories while accounting for ambiguous or missing values.

Collectively, these analyses illustrate how differently agencies record traffic stops, underscoring the importance of understanding data definitions and missingness before drawing broader conclusions.

### Racial Distribution of Traffic Stops Over Time: New York State

To begin the analysis, I examine how the racial composition of recorded traffic stops in New York State has changed over time. The goal here is descriptive rather than causal. I summarize the data as it appears in the tables without making claims about why these patterns occur or what underlying mechanisms may explain them.

The SQL query below groups stops by race and year from 2010-2018 and counts the number of stops in each category. Because the total number of stops varies much across years, I convert these counts into percentages so that each group’s share of all stops can be compared consistently over time.

It is important to note that these percentages reflect the distribution within the stop dataset itself, not the demographic composition of New York State’s driving population, nor the population as a whole. Therefore, the results show how the dataset is structured rather than making any statement about disparities or policing practices.

```{r}
library(DBI)
library(RMariaDB)
library(dbplyr)

con_traffic <- DBI::dbConnect(
  RMariaDB::MariaDB(),
  dbname = "traffic",
  host = Sys.getenv("TRAFFIC_HOST"),
  user = Sys.getenv("TRAFFIC_USER"),
  password = Sys.getenv("TRAFFIC_PWD")
)
```

```{sql, connection=con_traffic, output.var="ny_stops"}
SELECT
  subject_race AS race,
  COUNT(*) AS n_stops,
  YEAR(date) AS year
FROM ny_statewide_2020_04_01
WHERE subject_race IS NOT NULL
GROUP BY race, year
HAVING year BETWEEN 2010 AND 2018;
```

*Figure 1. Traffic Stops in New York City by Race and Year as %*

```{r}
library(ggplot2)
library(bit64)
library(dplyr)
library(scales)

ny_stops_clean <- ny_stops |>
  mutate(across(where(bit64::is.integer64), as.integer))

ny_stops_pct <- ny_stops_clean |>
  group_by(year) |>
  mutate(
    total_stops_year = sum(n_stops),
    pct = n_stops / total_stops_year * 100
  ) |>
  ungroup()

ggplot(ny_stops_pct, aes(x = year, y = pct, color = race)) +
  geom_line(linewidth = 1.1) +
  geom_point(size = 2) +
  scale_y_continuous(labels = percent_format(scale = 1)) +
  labs(
    title = "Percent of Traffic Stops in New York State by Race and Year",
    x = "Year",
    y = "Percent of Stops",
    color = "Race"
  ) +
  theme_minimal(base_size = 14)
```

*What does this mean?*

The figure shows how the racial composition of recorded traffic stops in New York State changed between 2010 and 2018. Across all of the years, the majority of stops in this dataset involved individuals classified as white, with their share gradually declining from roughly 78% in 2010 to around 70% by 2018. Other groups make up much smaller proportions of the dataset, though their relative shares show slight increases over time. For example, stops recorded as Black rise from about 10% to approximately 15%, and Hispanic stops increase from roughly 6% to about 9% by 2018.

For context (not as a formal denominator), recent American Community Survey estimates for New York State, as summarized by the U.S. Census Bureau via CensusReporter that about 53% of residents identify as white, 13% as Black, 9% as Asian, and 20% as Hispanic. However, these population figures and the stop shares in the SOPP dataset are not directly comparable as they refer to different time windows, different populations (residents vs. drivers), and do not account for exposure to traffic enforcement. A more robust analysis would compare demographic data with distinct year-by-year changes (which would be difficult to obtain, given that official Census Bureau collects data every 10 years). Without appropriate denominators (such as the racial composition of licensed drivers or traffic volume data), we cannot draw conclusions about disparities or exposure to police stops. The figure should therefore be interpreted strictly as a summary of how the stop records themselves are distributed across racial categories over time, rather than as evidence of the causes or consequences of those patterns.

### Most Common Types of Traffic Stops: Long Beach and San Bernardino, California

For the second part of the analysis, I compare how different agencies categorize traffic stops. Both Long Beach and San Bernardino report stop types, but neither provides detailed violation codes of what each specifically means. Instead, each uses broad categories such as vehicular or pedestrian, or other (bikes, scooters, etc.). The following SQL queries count how many times each stop type appears in each agency’s data.

```{sql, connection=con_traffic, output.var="lb_types"}
SELECT
type AS stop_type,
COUNT(*) AS type_count,
'Long Beach' AS city
FROM ca_long_beach_2020_04_01
GROUP BY stop_type;
```

```{sql, connection=con_traffic, output.var="sb_types"}
SELECT
type AS stop_type,
COUNT(*) AS type_count,
'San Bernardino' AS city
FROM ca_san_bernardino_2020_04_01
GROUP BY stop_type;
```

*Visualization: Comparing Stop Type Distributions Across Two Agencies*

```{r}
library(ggplot2)
library(dplyr)
library(scales)

# Combination of Long Beach & San Bernardino results

combined_types <- bind_rows(lb_types, sb_types) |>
  mutate(
    stop_type = ifelse(is.na(stop_type) | stop_type == "", "NA", stop_type)
    ) |>
  group_by(city) |>
  mutate(stop_type = reorder(stop_type, type_count)) |>
  ungroup()

ggplot(combined_types, aes(x = stop_type, y = type_count)) +
  geom_col(fill = "#4C72B0") +
  coord_flip() +
  scale_y_continuous(labels = comma) +
  facet_wrap(~ city, nrow = 1, scales = "free_x") +
  labs(
    title = "Distribution of Stop Types Across Two California Agencies",
    subtitle = "Long Beach vs. San Bernardino",
    x = "Stop Type",
    y = "Number of Stops"
    ) +
  theme_minimal(base_size = 14)
```

*What does this mean?*

The two agencies report broadly similar structures in their stop type distributions: both record overwhelmingly more vehicular stops than any other category. This is consistent with the fact that most police–civilian interactions captured in traffic stop databases involve drivers rather than pedestrians. However, Long Beach reports a noticeably larger number of stops classified as pedestrian compared with San Bernardino. This does not necessarily imply differences in enforcement intensity. Rather, it may reflect differences in population density, pedestrian activity, reporting conventions, or simply how each agency defines stop-type categories.

Both agencies also include a nontrivial number of stops labeled NA. Because the SOPP documentation notes that some agencies merge multiple non-vehicular stop types or provide incomplete labels, it is likely that the NA category captures a mixture of possibilities, such as bicycle stops, scooter stops, or simply missing or inconsistently coded information. Because these labels do not correspond to a single, clearly defined type, they should not be interpreted substantively.

Overall, this comparison is descriptive rather than inferential: the figure illustrates how each agency structures and reports its data, not how often particular behaviors occur or how enforcement differs across jurisdictions.

### Search Rates and Frisk Rates by Race: Florida

In the final part of this project, I analyze how often police searches and frisks occur during traffic stops in Florida, and how those decisions differ by race. The dataset includes search_conducted (whether any search occurred) and frisk_performed (whether a pat-down occurred).

Before computing rates, I combined ambiguous racial categories such as NA, "unknown", and "other" into a single group labeled "unknown/other". These entries are recorded inconsistently and do not correspond to a clearly defined racial group. In the raw data, for example, the NA category had an unusually high frisk rate, which almost certainly reflects missing or miscoded values rather than a meaningful disparity. Collapsing these ambiguous categories prevents over-interpreting noisy or incomplete data.

*Search + Frisk Rates (SQL)*

```{sql connection=con_traffic, output.var="fl_search"}
SELECT
CASE
WHEN subject_race IS NULL OR subject_race IN ('other', 'unknown', '') THEN 'unknown/other'
ELSE subject_race
END AS race,
COUNT(*) AS total_stops,
SUM(CASE WHEN search_conducted = 1 THEN 1 ELSE 0 END) AS num_searches,
SUM(CASE WHEN frisk_performed = 1 THEN 1 ELSE 0 END) AS num_frisk,
1.0 * SUM(CASE WHEN search_conducted = 1 THEN 1 ELSE 0 END) / COUNT(*) AS search_rate,
1.0 * SUM(CASE WHEN frisk_performed = 1 THEN 1 ELSE 0 END) / COUNT(*) AS frisk_rate
FROM fl_statewide_2020_04_01
GROUP BY race;
```

*Visualization: Search & Frisk Rates*

```{r}
library(dplyr)
library(ggplot2)
library(scales)
library(tidyr)

fl_search_long <- fl_search |>
  select(race, search_rate, frisk_rate) |>
  mutate(race = factor(race)) |>
  pivot_longer(
    cols = c(search_rate, frisk_rate),
    names_to = "metric",
    values_to = "rate"
  ) |>
  mutate(
    metric = recode(
      metric,
      "search_rate" = "Search rate",
      "frisk_rate"  = "Frisk rate"
    )
  )

ggplot(fl_search_long,
       aes(x = race, y = rate, fill = race)) +
  geom_col() +
  facet_wrap(~ metric, ncol = 2, scales = "free_x") +
  coord_flip() +
  scale_y_continuous(labels = percent_format(accuracy = 0.01)) +
  labs(
    title = "Search and Frisk Rates by Race in Florida",
    x = "Race",
    y = "Share of Stops Involving a Search or Frisk"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "none",
    strip.text = element_text(size = 12, face = "bold"),
    panel.spacing.x = unit(3, "lines")
  )
```

*What does this mean?*

In this Florida dataset, searches happen more often than frisks, though both are rare compared to the total number of stops. Frisk rates are particularly low (mostly under 0.01%), which is why the axis sits close to zero despite some variation across groups.

Black drivers have the highest search rate, followed by Hispanic and White drivers. We see a similar pattern with frisks, but because the actual numbers are so small, these results should be viewed with caution: when an event is this rare, even tiny numerical differences can look significant on a chart.

Ambiguous categories such as “NA,” “unknown,” and “other” were collapsed because they likely reflect inconsistent or missing data rather than meaningful population groups. In the raw data, for example, the NA category showed an implausibly high frisk rate. This pattern is likely more consistent with miscoding than substantive disparity. Collapsing these categories helps avoid overinterpreting noise and keeps the comparison focused on th distinct groups.

**Conclusion**

In summary, this project used three different slices of the SOPP database to describe how traffic stop data is structured, rather than attempting to prove causal links in policing. In New York, the data shows that the majority of stops involve white drivers, though that share is declining over time while the proportion of Black and Hispanic drivers has seen a modest rise. For Long Beach and San Bernardino, the overwhelming majority of stops are categorized as vehicular. Since pedestrian or ambiguous stops are rare, this suggests the dataset focuses heavily on driver-officer interactions.

The Florida analysis looked at post-stop outcomes, finding that while searches and frisks are rare events overall, recorded rates are highest for Black drivers. Throughout the analysis, I treated ambiguous labels like “NA” or "unknown" as likely data noise rather than distinct groups. Ultimately, these findings clarify what the SOPP data can tell us about how agencies record stops, while emphasizing the need to understand reporting differences and data limits before making broader generalizations. Further analysis would require denominators such as exposure or official (U.S. Census Bureau) population estimates to contextualize these patterns.

**Sources**

Stanford Open Policing Project (SOPP) Data. Traffic stop data compiled by the Stanford Open Policing Project and accessed through the Pomona College SQL server. Original dataset and documentation available at: <https://openpolicing.stanford.edu>. Pierson et al. (2020).

New York State Demographic Data. U.S. Census Bureau. New York – State Profile (Profile ID 04000US36). Demographics available at: <https://censusreporter.org/profiles/04000US36-new-york/>

(Note: CensusReporter provides a visualization layer, but all values originate from the U.S. Census Bureau.)
